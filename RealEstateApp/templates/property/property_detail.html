{% extends 'base.html' %}
{% load static %}
{% block style %}
<link rel="stylesheet" href="{% static 'css/property_details.css' %}"/>
<link rel="stylesheet" href="{% static 'css/star_ranking.css' %}"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}
{% block content %}
<div class="container-fluid">
 <div class="row">
 <div class="col-sm-7">
    <img class="" style="height:550px;width:103%;" src="{% if property.image %}{{ property.image.url }}{% endif %}">
   </div>
   <div class="col-sm-5">
   {% for image in images %}
   {% if forloop.counter == 1 %}
    <div class="row">
      
    <img class="" style="height:276px;width:100%;" src="{% if image.image %}{{ image.image.url }}{% endif %}">
    
    </div>
    
    {% elif forloop.counter == 2 %}
   <div class="row">
   <div class="col-sm-6">
   <img class="" style="height:272px;width:108%;" src="{% if image.image %}{{ image.image.url }}{% endif %}">
  
   </div>
   {% elif forloop.counter == 3 %}
    <div class="col-sm-6">
   <img class="" style="height:272px;width:100%;" src="{% if image.image %}{{ image.image.url }}{% endif %}">
  
   </div>
   </div>
   {% else %}
    {% endif %}
{% endfor %}
</div>
  </div>
  <div class="container mt-4">
  <p id="property">{{property.property_name}}</p>  
  <hr style="width: 15%;"> 
  
  <div class="row align-items-start mb-4" style="height:50%;">
    <div class="col-md-7">
    <div class="row">
    <div class="col">
      <p> Room Type : {{property.room_type}}</p>
            <p>Bedroom : {{property.bed_room}}</p>
            <p> Guest : {{property.guest}}</p>
            <p>Bed : {{property.beds}}</p>
      </div>
      <div class="col">
      {% if ranking.rank__avg %}
      Ranking : 
      {% endif %}
      <input class="d-none" type="text" value='{{ranking.rank__avg}}' id="star_ranking">
      <span class="fa fa-star" id="star1"></span>
      <span class="fa fa-star" id="star2"></span>
      <span class="fa fa-star" id="star3"></span>
      <span class="fa fa-star" id="star4"></span>
      <span class="fa fa-star" id="star5"></span>
      </div>
    </div>
            <h5>Abbout this Listing</h5>
            <p>{{property.Description}}</p>
    </div>

    <div class="col-5 ">
     {% if property.author == user %}
       <a class="btn btn-outline-primary float-left me-4" href="{% url 'realestateapp:create_property_images' slug=property.slug %}">Add Images</a>
       
       <a class="btn btn-outline-primary float-center" href="{% url 'realestateapp:Update_property' slug=property.slug %}">Update</a>
       <a class="btn btn-outline-danger float-right" href="{% url 'realestateapp:delete_property' slug=property.slug %}">Delete</a>
       
       <br>
       <br>
            

       
       {% endif %}
       <hr>


        <p>  Cost : {{property.cost}} </p>
        <label>Check-In</label>
        <label class="float-right">Check-Out</label>
  <form class="mb-4">
        <div class="input-group">
        
    <input type="date" id="check_in" class="form-control" >
    <div class="input-group-prepend">
        <span class="input-group-text">-</span>
    </div>
    <input type="date" id="check_out" class="form-control">
</div>
<div class="col-auto">
    <input type="button" class="btn btn-primary mt-2 mb-4 float-right" onclick="showDiv()" value="Search">
  </div>
</form>
 <input class="d-none" type="text" value='{{property.cost}}' id="price">
 <input class="d-none" type="text" value='{{booking}}' id="booked">
    <div class="mt-8" style="display:none;" id="welcomeDiv">
    <div class="card">
    Booking Details-</br>
    <p>cost :<span id="cost"> </span></p>
    <p>Availability : <span id="booking"> </span></p>
    <a id="book_property" class="card-text float-right text-decoration-none" style="font-size: 0.9rem;display:none;" href="{% url 'booking:create_booking' %}" >
        Book
        </a>
    </div>
    </div>
    </div>
     <div class="card">
    {% if request.user.username %}
      {% if property.author.username == request.user.username %}
      {% else %}
      <a class="card-text float-right text-decoration-none" style="font-size: 0.9rem" href="{% url 'realestateapp:create_ranking_property' slug=property.slug %}" >
        Add ranks
        </a>
        {% endif %}
     {% endif %}
    </div>
    <div class="card">
    {% if feedback %}
    <h4>Feedback of {{property.property_name}} </h4>
     {% for feedback_item in feedback %}
        <div class="card-body">
             <label > {{feedback_item.user.username}} </label>
             <p>{{ feedback_item.feedback }}</p>
        </div>

     {% endfor %}
     {% endif %}
    </div>
    <div class="card">
    {% if request.user.username %}
      <a class="card-text float-right text-decoration-none" style="font-size: 0.9rem" href="{% url 'realestateapp:create_feedback_property' slug=property.slug %}" >
        Give Feedback
        </a>
     {% endif %}
    </div>
  </div>

</div>
<hr>
{% include 'home/footer.html' %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/
jquery.min.js"></script>
<script >
var star = document.getElementById('star_ranking').value;
var star = parseInt(star);
console.log(star);
for(i=1;i<=star;i++){
  var star1 = "star"+ i;
  document.getElementById(star1).style.color = 'yellow';
}

function showDiv() {
  var checkin = document.getElementById('check_in').value;
  var checkout = document.getElementById('check_out').value;
  console.log(checkin)
  date1 = new Date(checkin);
  date2 = new Date(checkout);
  date1time = date1.getTime();
  date2time = date2.getTime();
  day = date2time-date1time;
  day = day/(1000 * 60 * 60 * 24) + 1;
   price = document.getElementById('price').value;
   cost = day*price;
   document.getElementById('cost').innerHTML = cost;
   book = document.getElementById('booked').value;
   var booked = "{{booking}}";
   mydata = {
     'checkin':checkin,
      'checkout':checkout,
      'property_slug':'{{property.slug}}',
   }
   console.log(mydata);
   $.ajax({
     url : "{% url 'booking:booking_search' %}",
     method:"GET",
     data :mydata,
      success:function(data){
       console.log("success")
       if(data.status == 1){
         document.getElementById('booking').innerHTML = "Available Property, Now Book it...";
         document.getElementById('book_property').style.display = "block";
       }
       else{
         document.getElementById('booking').innerHTML = "Already Booked Hotel,Please try another date...";
       }
       
      },
     
     
   })
   
   document.getElementById('welcomeDiv').style.display = "block";
}
</script>
{% endblock %}